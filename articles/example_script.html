<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Basic PvSTATEM functionalities • PvSTATEM</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basic PvSTATEM functionalities">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PvSTATEM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example_script.html">Basic PvSTATEM functionalities</a></li>
    <li><a class="dropdown-item" href="../articles/our_datasets.html">Our datasets</a></li>
    <li><a class="dropdown-item" href="../articles/our_plots.html">Introduction to plots created by our package</a></li>
    <li><a class="dropdown-item" href="../articles/our_reports.html">Overview of reports generated by PvSTATEM package</a></li>
    <li><a class="dropdown-item" href="../articles/parsers.html">Raw data parsers</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mini-pw/PvSTATEM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Basic PvSTATEM functionalities</h1>
                        <h4 data-toc-skip class="author">Tymoteusz
Kwieciński</h4>
            
            <h4 data-toc-skip class="date">2025-01-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mini-pw/PvSTATEM/blob/v0.2.0/vignettes/example_script.Rmd" class="external-link"><code>vignettes/example_script.Rmd</code></a></small>
      <div class="d-none name"><code>example_script.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="reading-the-plate-object">Reading the plate object<a class="anchor" aria-label="anchor" href="#reading-the-plate-object"></a>
</h2>
<p>The basic functionality of the <code>PvSTATEM</code> package is
reading raw MBA data. To present the package’s functionalities, we use a
sample dataset from the Covid OISE study, which is pre-loaded into the
package. You might want to replace these variables with paths to your
files on your local disk. Firstly, let us load the dataset as the
<code>plate</code> object.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mini-pw/PvSTATEM" class="external-link">PvSTATEM</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">plate_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"CovidOISExPONTENT.csv"</span>, package <span class="op">=</span> <span class="st">"PvSTATEM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># get the filepath of the csv dataset</span></span>
<span></span>
<span><span class="va">layout_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"CovidOISExPONTENT_layout.xlsx"</span>, package <span class="op">=</span> <span class="st">"PvSTATEM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">plate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_luminex_data.html">read_luminex_data</a></span><span class="op">(</span><span class="va">plate_filepath</span>, <span class="va">layout_filepath</span><span class="op">)</span> <span class="co"># read the data</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading Luminex data from: /home/runner/work/_temp/Library/PvSTATEM/extdata/CovidOISExPONTENT.csv</span></span>
<span><span class="co">#&gt; using format xPONENT</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; New plate object has been created with name: CovidOISExPONTENT!</span></span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; </span></span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Plate with 96 samples and 30 analytes</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="processing-the-whole-plate">Processing the whole plate<a class="anchor" aria-label="anchor" href="#processing-the-whole-plate"></a>
</h2>
<p>Once we have loaded the plate object, we may process it using the
function <code>process_plate</code>. This function fits a model to each
analyte using the standard curve samples. It computes RAU values for
each analyte using the corresponding model. The computed RAU values are
then saved to a CSV file in a specified folder, with a specified name,
which by default is based on the plate name and the normalisation type -
this function also allows normalisation for nMFI values, more details
about this method may be found in the <code>nMFI</code> section of this
document, or in documentation of <code><a href="../reference/get_nmfi.html">?get_nmfi</a></code> function.</p>
<p>To get more information about the function, check
<code><a href="../reference/process_plate.html">?process_plate</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span>check <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># create a temporary directory to store the output</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_plate.html">process_plate</a></span><span class="op">(</span><span class="va">plate</span>, output_dir <span class="op">=</span> <span class="va">example_dir</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Fitting the models and predicting RAU for each analyte</span></span>
<span><span class="co">#&gt; Adding the raw MFI values to the output dataframe</span></span>
<span><span class="co">#&gt; Saving the computed RAU values to a CSV file located in: '/tmp/RtmpWkh0XU/CovidOISExPONTENT_RAU.csv'</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] "Spike_6P"          "ME"                "HKU1_S"           </span></span>
<span><span class="co">#&gt;  [4] "OC43_NP"           "OC43_S"            "HKU1_NP"          </span></span>
<span><span class="co">#&gt;  [7] "X229E_NP"          "Mumps_NP"          "RBD_B16171"       </span></span>
<span><span class="co">#&gt; [10] "NL63_NP"           "RBD_B16172"        "RBD_wuhan"        </span></span>
<span><span class="co">#&gt; [13] "NL63_S"            "X229E_S"           "Spike_B16172"     </span></span>
<span><span class="co">#&gt; [16] "Spike_B117"        "Measles_NP"        "Ade5"             </span></span>
<span><span class="co">#&gt; [19] "NP"                "Spike_P1"          "Rub"              </span></span>
<span><span class="co">#&gt; [22] "Ade40"             "RBD_B117"          "Spike_B1351"      </span></span>
<span><span class="co">#&gt; [25] "FluA"              "RBD_B1351"         "RBD_P15"          </span></span>
<span><span class="co">#&gt; [28] "S2"                "Spike_omicron"     "RBD_omicron"      </span></span>
<span><span class="co">#&gt; [31] "Spike_6P_raw"      "ME_raw"            "HKU1_S_raw"       </span></span>
<span><span class="co">#&gt; [34] "OC43_NP_raw"       "OC43_S_raw"        "HKU1_NP_raw"      </span></span>
<span><span class="co">#&gt; [37] "X229E_NP_raw"      "Mumps_NP_raw"      "RBD_B16171_raw"   </span></span>
<span><span class="co">#&gt; [40] "NL63_NP_raw"       "RBD_B16172_raw"    "RBD_wuhan_raw"    </span></span>
<span><span class="co">#&gt; [43] "NL63_S_raw"        "X229E_S_raw"       "Spike_B16172_raw" </span></span>
<span><span class="co">#&gt; [46] "Spike_B117_raw"    "Measles_NP_raw"    "Ade5_raw"         </span></span>
<span><span class="co">#&gt; [49] "NP_raw"            "Spike_P1_raw"      "Rub_raw"          </span></span>
<span><span class="co">#&gt; [52] "Ade40_raw"         "RBD_B117_raw"      "Spike_B1351_raw"  </span></span>
<span><span class="co">#&gt; [55] "FluA_raw"          "RBD_B1351_raw"     "RBD_P15_raw"      </span></span>
<span><span class="co">#&gt; [58] "S2_raw"            "Spike_omicron_raw" "RBD_omicron_raw"</span></span></code></pre>
<p>We can take a look at a slice of the produced dataframe (as not to
overcrowd the article).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                Spike_6P        ME     HKU1_S   OC43_NP     OC43_S</span></span>
<span><span class="co">#&gt; CO-F-226-01-CF 20000.00  5768.628   829.2993 4289.2647  6871.6113</span></span>
<span><span class="co">#&gt; CO-F-263-02-KC 20000.00  4050.148  8128.2569 3681.9063  8828.6351</span></span>
<span><span class="co">#&gt; CO-F-080-02-TV 20000.00  5889.229 15877.9572 1473.4541 11012.7498</span></span>
<span><span class="co">#&gt; CO-F-215-01-BA 20000.00 10446.952  6069.3115  828.9687  1116.0059</span></span>
<span><span class="co">#&gt; CO-H-SD-039-BC 17665.36  2656.989  4055.8890  990.4044   670.7302</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="quality-control-and-normalisation-details">Quality control and normalisation details<a class="anchor" aria-label="anchor" href="#quality-control-and-normalisation-details"></a>
</h2>
<p>Apart from the <code>process_plate</code> function, the package
provides a set of methods allowing for more detailed and advanced
quality control and normalisation of the data.</p>
<div class="section level3">
<h3 id="plate-summary-and-details">Plate summary and details<a class="anchor" aria-label="anchor" href="#plate-summary-and-details"></a>
</h3>
<p>After the plate is successfully loaded, we can look at some basic
information about it.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Summary of the plate with name 'CovidOISExPONTENT':</span></span>
<span><span class="co">#&gt; Plate examination date: 2022-05-11 16:45:00</span></span>
<span><span class="co">#&gt; Total number of samples: 96</span></span>
<span><span class="co">#&gt; Number of blank samples: 1</span></span>
<span><span class="co">#&gt; Number of standard curve samples: 11</span></span>
<span><span class="co">#&gt; Number of positive control samples: 0</span></span>
<span><span class="co">#&gt; Number of negative control samples: 0</span></span>
<span><span class="co">#&gt; Number of test samples: 84</span></span>
<span><span class="co">#&gt; Number of analytes: 30</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span>include_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># more detailed summary</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Summary of the plate with name 'CovidOISExPONTENT':</span></span>
<span><span class="co">#&gt; Plate examination date: 2022-05-11 16:45:00</span></span>
<span><span class="co">#&gt; Total number of samples: 96</span></span>
<span><span class="co">#&gt; Number of blank samples: 1</span></span>
<span><span class="co">#&gt; Number of standard curve samples: 11</span></span>
<span><span class="co">#&gt; Sample names: '1/50', '1/100', '1/200', '1/400', '1/800', '1/1600', '1/3200', '1/6400', '1/12800', '1/25600', '1/102400'</span></span>
<span><span class="co">#&gt; Number of positive control samples: 0</span></span>
<span><span class="co">#&gt; Number of negative control samples: 0</span></span>
<span><span class="co">#&gt; Number of test samples: 84</span></span>
<span><span class="co">#&gt; Number of analytes: 30</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span><span class="op">$</span><span class="va">sample_names</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] "B"              "1/50"           "1/100"          "1/200"         </span></span>
<span><span class="co">#&gt;  [5] "1/400"          "1/800"          "1/1600"         "1/3200"        </span></span>
<span><span class="co">#&gt;  [9] "1/6400"         "1/12800"        "1/25600"        "1/102400"      </span></span>
<span><span class="co">#&gt; [13] "CO-F-226-01-CF" "CO-F-263-02-KC" "CO-F-080-02-TV" "CO-F-215-01-BA"</span></span>
<span><span class="co">#&gt; [17] "CO-H-SD-039-BC" "CO-H-RD-053-MO" "CO-F-030-01-LA" "CO-F-204-01-TC"</span></span>
<span><span class="co">#&gt; [21] "CO-F-009-01-CS" "CO-F-156-02-GB" "CO-F-402-03-DE" "CO-H-SK-021-BC"</span></span>
<span><span class="co">#&gt; [25] "CO-F-226-02-CM" "CO-F-266-01-LC" "CO-F-080-03-TA" "CO-F-215-02-BN"</span></span>
<span><span class="co">#&gt; [29] "CO-H-SD-042-DD" "CO-H-RK-002-BA" "CO-F-031-01-LD" "CO-F-204-02-TT"</span></span>
<span><span class="co">#&gt; [33] "CO-F-021-03-DF" "CO-F-156-03-GN" "CO-F-402-04-DR" "CO-H-SK-023-DC"</span></span>
<span><span class="co">#&gt; [37] "CO-F-226-03-CG" "CO-F-272-01-DF" "CO-F-080-04-TM" "CO-F-215-03-BA"</span></span>
<span><span class="co">#&gt; [41] "CO-H-SK-004-GA" "CO-H-RK-004-WN" "CO-F-112-01-CN" "CO-F-220-01-VV"</span></span>
<span><span class="co">#&gt; [45] "CO-F-028-01-PJ" "CO-F-214-01-SP" "CO-F-402-05-DS" "CO-H-SK-029-LC"</span></span>
<span><span class="co">#&gt; [49] "CO-F-234-01-LC" "CO-F-310-01-DC" "CO-F-082-01-OF" "CO-F-299-01-CS"</span></span>
<span><span class="co">#&gt; [53] "CO-H-SK-006-MS" "CO-H-RK-007-CJ" "CO-F-180-01-PN" "CO-F-243-01-BL"</span></span>
<span><span class="co">#&gt; [57] "CO-F-124-01-SV" "CO-F-237-01-LE" "CO-H-SD-002-WL" "CO-H-SK-030-MJ"</span></span>
<span><span class="co">#&gt; [61] "CO-F-234-02-LS" "CO-F-311-01-PC" "CO-F-089-01-DP" "CO-F-325-01-LN"</span></span>
<span><span class="co">#&gt; [65] "CO-H-SK-011-CC" "CO-H-RK-009-MB" "CO-F-180-02-DM" "CO-F-243-02-SH"</span></span>
<span><span class="co">#&gt; [69] "CO-F-134-01-MK" "CO-F-281-01-BV" "CO-H-SD-013-LV" "CO-H-SK-031-CP"</span></span>
<span><span class="co">#&gt; [73] "CO-F-260-01-GD" "CO-F-075-01-BA" "CO-F-089-02-DC" "CO-H-SD-004-CG"</span></span>
<span><span class="co">#&gt; [77] "CO-H-SK-051-DA" "CO-H-RK-010-VP" "CO-F-180-03-DR" "CO-F-276-01-ME"</span></span>
<span><span class="co">#&gt; [81] "CO-F-134-02-GM" "CO-F-402-01-BH" "CO-H-SD-043-BS" "CO-H-SK-039-AA"</span></span>
<span><span class="co">#&gt; [85] "CO-F-260-02-GC" "CO-F-075-02-FM" "CO-F-139-01-BP" "CO-H-SD-021-PC"</span></span>
<span><span class="co">#&gt; [89] "CO-H-SK-056-MN" "CO-F-027-02-SL" "CO-F-180-04-DC" "CO-F-027-01-SF"</span></span>
<span><span class="co">#&gt; [93] "CO-F-156-01-GA" "CO-F-402-02-DV" "CO-H-SK-018-VC" "CO-F-045-01-SN"</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span><span class="op">$</span><span class="va">analyte_names</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] "Spike_6P"      "ME"            "HKU1_S"        "OC43_NP"      </span></span>
<span><span class="co">#&gt;  [5] "OC43_S"        "HKU1_NP"       "X229E_NP"      "Mumps_NP"     </span></span>
<span><span class="co">#&gt;  [9] "RBD_B16171"    "NL63_NP"       "RBD_B16172"    "RBD_wuhan"    </span></span>
<span><span class="co">#&gt; [13] "NL63_S"        "X229E_S"       "Spike_B16172"  "Spike_B117"   </span></span>
<span><span class="co">#&gt; [17] "Measles_NP"    "Ade5"          "NP"            "Spike_P1"     </span></span>
<span><span class="co">#&gt; [21] "Rub"           "Ade40"         "RBD_B117"      "Spike_B1351"  </span></span>
<span><span class="co">#&gt; [25] "FluA"          "RBD_B1351"     "RBD_P15"       "S2"           </span></span>
<span><span class="co">#&gt; [29] "Spike_omicron" "RBD_omicron"</span></span></code></pre>
<p>The summary can also be accessed using the built-in generic method
<code>summary</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">plate</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Summary of the plate with name 'CovidOISExPONTENT':</span></span>
<span><span class="co">#&gt; Plate examination date: 2022-05-11 16:45:00</span></span>
<span><span class="co">#&gt; Total number of samples: 96</span></span>
<span><span class="co">#&gt; Number of blank samples: 1</span></span>
<span><span class="co">#&gt; Number of standard curve samples: 11</span></span>
<span><span class="co">#&gt; Number of positive control samples: 0</span></span>
<span><span class="co">#&gt; Number of negative control samples: 0</span></span>
<span><span class="co">#&gt; Number of test samples: 84</span></span>
<span><span class="co">#&gt; Number of analytes: 30</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="quality-control">Quality control<a class="anchor" aria-label="anchor" href="#quality-control"></a>
</h3>
<p>The package can plot the RAU along the MFI values, allowing manual
inspection of the standard curve. This method raises a warning in case
the MFI values were not adjusted using the blank samples.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte.html">plot_standard_curve_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"OC43_S"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-6-1.png" width="70%"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span><span class="op">$</span><span class="fu">blank_adjustment</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Plate with 96 samples and 30 analytes</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plate</span><span class="op">$</span><span class="va">blank_adjusted</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte.html">plot_standard_curve_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"OC43_S"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-6-2.png" width="70%"></p>
<p>We can also plot the standard curve for different analytes and data
types. A list of all available analytes on the plate can be accessed
using the command <code>plate$analyte_names</code>.</p>
<p>By default, all the operations are performed on the
<code>Median</code> value of the samples; this option can be selected
from the <code>data_type</code> parameter of the function.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte.html">plot_standard_curve_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"RBD_wuhan"</span>, data_type <span class="op">=</span> <span class="st">"Mean"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-7-1.png" width="70%"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte.html">plot_standard_curve_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"RBD_wuhan"</span>, data_type <span class="op">=</span> <span class="st">"Avg Net MFI"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-7-2.png" width="70%"></p>
<p>This plot may be used to assess the standard curve’s quality and
anticipate some potential issues with the data. For instance, if we
plotted the standard curve for the analyte, <code>ME</code>, we could
notice that the <code>Median</code> value of the sample with RAU of
<code>39.06</code> is abnormally large, which may indicate a problem
with the data.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte.html">plot_standard_curve_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"ME"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-8-1.png" width="70%"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte.html">plot_standard_curve_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"ME"</span>, log_scale <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-8-2.png" width="70%"></p>
<p>The plotting function has more options, such as selecting which axis
the log scale should be applied or reversing the curve. More detailed
information can be found in the function documentation, accessed by
executing the command <code><a href="../reference/plot_standard_curve_analyte.html">?plot_standard_curve_analyte</a></code>.</p>
<p>Another valuable method of inspecting the potential errors of the
data is <code>plot_mfi_for_analyte</code>. This method plots the MFI
values of standard curve samples for a given analyte along the boxplot
of the MFI values of the test samples.</p>
<p>It helps identify the outlier samples and check if the test samples
are within the range of the standard curve samples.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mfi_for_analyte.html">plot_mfi_for_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"OC43_S"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-9-1.png" width="70%"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mfi_for_analyte.html">plot_mfi_for_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"Spike_6P"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-9-2.png" width="70%"></p>
<p>For the <code>Spike_6P</code> analyte, the MFI values don’t fall
within the range of the standard curve samples, which could be
problematic for the model. The test RAU values will be extrapolated (up
to a point) from the standard curve, which may lead to incorrect
results.</p>
</div>
<div class="section level3">
<h3 id="normalisation">Normalisation<a class="anchor" aria-label="anchor" href="#normalisation"></a>
</h3>
<p>After inspection, we may create the model for the standard curve of a
specific antibody. The model is fitted using the <code>nplr</code>
package, which provides a simple interface for fitting n-parameter
logistic regression models. Still, to create a more straightforward
interface for the user, we encapsulated this model into our own class
called <code>Model</code> for simplicity. The detailed documentation of
the <code>Model</code> class can be found by executing the command
<code><a href="../reference/Model.html">?Model</a></code>.</p>
<p>The model is then used to predict the RAU values of the samples based
on the MFI values.</p>
<div class="section level4">
<h4 id="rau-vs-dilution">RAU vs dilution<a class="anchor" aria-label="anchor" href="#rau-vs-dilution"></a>
</h4>
<p>To distinguish between actual dilution values (the ones known for the
standard curve samples) from the dilution predictions (obtained using
the fitted standard curve), we introduced into our package a unit called
RAU (Relative Antibody Unit) which is equal to the dilution
<strong>prediction</strong> multiplied by a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>,</mo><mn>000</mn><mo>,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">1,000,000</annotation></semantics></math>
to provide a more readable value.</p>
</div>
<div class="section level4">
<h4 id="inner-nplr-model">Inner nplr model<a class="anchor" aria-label="anchor" href="#inner-nplr-model"></a>
</h4>
<p><code>nplr</code> package fits the model using the formula:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>B</mi><mo>+</mo><mfrac><mrow><mi>T</mi><mo>−</mo><mi>B</mi></mrow><msup><mrow><mo stretchy="true" form="prefix">[</mo><mn>1</mn><mo>+</mo><msup><mn>10</mn><mrow><mi>b</mi><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mo stretchy="true" form="postfix">]</mo></mrow><mi>s</mi></msup></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex"> y = B + \frac{T - B}{[1 + 10^{b \cdot (x_{mid} - x)}]^s},</annotation></semantics></math>
where:</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
is the predicted value, MFI in our case,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
is the independent variable, dilution of the standard curve samples in
our case,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>
is the bottom plateau - the right horizontal asymptote,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
is the top plateau - the left horizontal asymptote,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>
is the slope of the curve at the inflection point,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub><annotation encoding="application/x-tex">x_{mid}</annotation></semantics></math>
is x-coordinate at the inflection point,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
is the asymmetric coefficient.</p></li>
</ul>
<p>This equation is referred to as the Richards’ equation. More
information about the model can be found in the <code>nplr</code>
package documentation.</p>
</div>
<div class="section level4">
<h4 id="predicting-rau">Predicting RAU<a class="anchor" aria-label="anchor" href="#predicting-rau"></a>
</h4>
<p>By reversing that logistic function, we can predict the dilution of
the samples based on the MFI values. The RAU value is then the predicted
dilution of the sample multiplied by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>,</mo><mn>000</mn><mo>,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">1,000,000</annotation></semantics></math>.</p>
<p>To limit the extrapolation error from above (values above maximum RAU
value for the standard curve samples), we clip all predictions above to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
where <code>over_max_extrapolation</code> is user controlled parameter
to the <code>predict</code> function. By default
<code>over_max_extrapolation</code> is set to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h4>
<p>By default, the <code>nplr</code> model transforms the x values using
the log10 function. To create a model for a specific analyte, we use the
<code>create_standard_curve_model_analyte</code> function, which fits
and returns the model for the analyte.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_standard_curve_model_analyte.html">create_standard_curve_model_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"OC43_S"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Instance of the Model class fitted for analyte ' OC43_S ': </span></span>
<span><span class="co">#&gt;  - fitted with 5 parameters</span></span>
<span><span class="co">#&gt;  - using 11 samples</span></span>
<span><span class="co">#&gt;  - using log residuals (mfi):  TRUE </span></span>
<span><span class="co">#&gt;  - using log dilution:  TRUE </span></span>
<span><span class="co">#&gt;  - top asymptote: 28414.96 </span></span>
<span><span class="co">#&gt;  - bottom asymptote: 38.60885 </span></span>
<span><span class="co">#&gt;  - goodness of fit: 0.9970645 </span></span>
<span><span class="co">#&gt;  - weighted goodness of fit: 0.9998947</span></span></code></pre>
<p>Since our <code>model</code> object contains all the characteristics
and parameters of the fitted regression model. The model can be used to
predict the RAU values of the samples based on the MFI values. The
output above shows the most critical parameters of the fitted model.</p>
<p>The predicted values may be used to plot the standard curve, which
can be compared to the sample values.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte_with_model.html">plot_standard_curve_analyte_with_model</a></span><span class="op">(</span><span class="va">plate</span>, <span class="va">model</span>, log_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-11-1.png" width="70%"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte_with_model.html">plot_standard_curve_analyte_with_model</a></span><span class="op">(</span><span class="va">plate</span>, <span class="va">model</span>, log_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span><span class="op">)</span>, plot_asymptote <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-11-2.png" width="70%"></p>
<p>Apart from the plotting, the package can predict the values of all
the samples on the plate.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mfi_values</span> <span class="op">&lt;-</span> <span class="va">plate</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Median</span><span class="op">$</span><span class="va">OC43_S</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mfi_values</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1]   43.0 4193.0 1982.0 1308.0  681.0  365.5</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicted_rau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">mfi_values</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">predicted_rau</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;            RAU    MFI</span></span>
<span><span class="co">#&gt; 1     2.375258   43.0</span></span>
<span><span class="co">#&gt; 2 20000.000000 4193.0</span></span>
<span><span class="co">#&gt; 3  8326.658518 1982.0</span></span>
<span><span class="co">#&gt; 4  5240.371360 1308.0</span></span>
<span><span class="co">#&gt; 5  2556.577252  681.0</span></span>
<span><span class="co">#&gt; 6  1242.668884  365.5</span></span></code></pre>
<p>The dataframe contains original MFI values and the predicted RAU
values based on the model.</p>
<p>In order to allow extrapolation from above (up to a certain value) we
can set <code>over_max_extrapolation</code> to a positive value. To
illustrate that we can look at prediction plots. The
<code>plot_standard_curve_analyte_with_model</code> takes any additional
parameters and passes them to a <code>predict</code> method so we can
visually see the effect of the <code>over_max_extrapolation</code>
parameter.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_standard_curve_model_analyte.html">create_standard_curve_model_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"Spike_6P"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_standard_curve_analyte_with_model.html">plot_standard_curve_analyte_with_model</a></span><span class="op">(</span><span class="va">plate</span>, <span class="va">model</span>, log_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-13-1.png" width="70%"></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte_with_model.html">plot_standard_curve_analyte_with_model</a></span><span class="op">(</span><span class="va">plate</span>, <span class="va">model</span>, log_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span><span class="op">)</span>, over_max_extrapolation <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-14-1.png" width="70%"></p>
</div>
</div>
<div class="section level3">
<h3 id="nmfi">nMFI<a class="anchor" aria-label="anchor" href="#nmfi"></a>
</h3>
<p>In some cases, the RAU values cannot be reliably calculated. This may
happen when the MFI values of test samples are way higher than those of
the standard curve samples. In that case, to avoid extrapolation but to
be still able to compare the samples across the plates, we introduced a
new unit called nMFI (Normalized MFI). The nMFI is calculated as the MFI
value of the test sample divided by the MFI value of the standard curve
sample with the selected dilution value.</p>
<p>nMFI values of the samples can be calculated in two ways - using the
<code>get_nmfi</code> function or with the <code>process_plate</code>
function that also saves the output into the CSV file by setting the
<code>normalisation_type</code> parameter to <code>nMFI</code> in the
<code>process_plate</code> function. By default the output will be saved
as a file with the same name as the plate name but with the
<code>_nMFI</code> suffix.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nmfi_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_nmfi.html">get_nmfi</a></span><span class="op">(</span><span class="va">plate</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># process plate with nMFI normalisation</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_plate.html">process_plate</a></span><span class="op">(</span><span class="va">plate</span>, output_dir <span class="op">=</span> <span class="va">example_dir</span>, normalisation_type <span class="op">=</span> <span class="st">"nMFI"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Computing nMFI values for each analyte</span></span>
<span><span class="co">#&gt; Adding the raw MFI values to the output dataframe</span></span>
<span><span class="co">#&gt; Saving the computed nMFI values to a CSV file located in: '/tmp/RtmpWkh0XU/CovidOISExPONTENT_nMFI.csv'</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                Spike_6P       ME    HKU1_S   OC43_NP    OC43_S</span></span>
<span><span class="co">#&gt; CO-F-226-01-CF 5.842408 1.988889 0.3821903 1.5449180 2.4537445</span></span>
<span><span class="co">#&gt; CO-F-263-02-KC 7.171064 1.471111 2.6996681 1.3481967 3.0638767</span></span>
<span><span class="co">#&gt; CO-F-080-02-TV 7.169239 2.024444 4.6227876 0.6085246 3.7077827</span></span>
<span><span class="co">#&gt; CO-F-215-01-BA 7.586304 3.288889 2.1028761 0.3816393 0.4919236</span></span>
<span><span class="co">#&gt; CO-H-SD-039-BC 3.695481 1.037778 1.4778761 0.4393443 0.3340675</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tymoteusz Kwiecinski, Jakub Grzywaczewski, Mateusz Nizwantowski.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
